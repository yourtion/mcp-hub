# MCP Hub Web 界面使用指南

本指南详细介绍如何使用 MCP Hub 的 Web 管理界面。

## 目录

- [快速开始](#快速开始)
- [认证与登录](#认证与登录)
- [仪表板](#仪表板)
- [服务器管理](#服务器管理)
- [工具管理](#工具管理)
- [组管理](#组管理)
- [API 到 MCP 集成](#api-到-mcp-集成)
- [调试工具](#调试工具)
- [配置管理](#配置管理)
- [常见问题](#常见问题)

## 快速开始

### 启动系统

1. **启动后端服务器**:
   ```bash
   cd backend
   pnpm dev
   ```
   后端将在 `http://localhost:3000` 运行。

2. **启动前端界面**:
   ```bash
   cd frontend
   pnpm dev
   ```
   前端将在 `http://localhost:8080` 运行。

3. **访问界面**:
   在浏览器中打开 `http://localhost:8080`

### 首次登录

默认管理员凭据：
- **用户名**: `admin`
- **密码**: `admin`

⚠️ **重要**: 在生产环境中，请立即更改默认密码！

## 认证与登录

### 登录流程

1. 访问 Web 界面，系统会自动跳转到登录页面
2. 输入用户名和密码
3. 点击"登录"按钮
4. 登录成功后，系统会自动跳转到仪表板

### 会话管理

- **自动刷新**: 访问令牌会在过期前自动刷新
- **持久登录**: 勾选"记住我"可以在关闭浏览器后保持登录状态
- **安全退出**: 点击右上角用户菜单中的"退出登录"

### 密码修改

生产环境中修改密码的步骤：

1. 编辑 `backend/config/system.json`
2. 使用 bcrypt 生成新密码哈希：
   ```javascript
   const bcrypt = require('bcryptjs');
   const hash = bcrypt.hashSync('your-new-password', 10);
   console.log(hash);
   ```
3. 更新配置文件中的密码哈希
4. 重启后端服务

## 仪表板

仪表板提供系统的整体概览和实时监控。

### 主要功能

#### 1. 系统统计卡片

显示关键指标：
- **服务器总数**: 已配置的 MCP 服务器数量
- **已连接服务器**: 当前在线的服务器数量
- **可用工具**: 所有服务器提供的工具总数
- **组数量**: 已配置的服务器组数量

#### 2. 实时活动流

显示最近的系统活动：
- 服务器连接/断开事件
- 工具执行记录
- 系统错误和警告
- 配置变更记录

#### 3. 性能监控图表

实时性能指标：
- **请求速率**: 每分钟的请求数量
- **响应时间**: 平均响应时间趋势
- **错误率**: 错误请求的百分比
- **工具使用排行**: 最常用的工具

#### 4. 系统健康状态

显示系统各组件的健康状态：
- ✅ 健康 (Healthy)
- ⚠️ 警告 (Warning)
- ❌ 错误 (Error)

### 快速操作

仪表板提供快速访问常用功能：
- 添加新服务器
- 测试工具
- 查看日志
- 系统设置

## 服务器管理

管理 MCP 服务器的连接和配置。

### 查看服务器列表

服务器列表显示所有已配置的服务器：

| 列名 | 说明 |
|------|------|
| 名称 | 服务器标识符 |
| 类型 | stdio / SSE / WebSocket |
| 状态 | 连接状态（已连接/已断开/连接中/错误）|
| 工具数 | 该服务器提供的工具数量 |
| 最后连接 | 最后一次成功连接的时间 |
| 操作 | 连接/断开/编辑/删除 |

### 添加新服务器

1. 点击"添加服务器"按钮
2. 填写服务器配置表单：

   **基本信息**:
   - **服务器 ID**: 唯一标识符（如 `filesystem`）
   - **名称**: 显示名称（如 "文件系统服务器"）
   - **描述**: 服务器用途说明（可选）

   **连接配置**:
   - **类型**: 选择 stdio / SSE / WebSocket
   - **命令**: 启动服务器的命令（如 `npx`）
   - **参数**: 命令行参数数组
   - **环境变量**: 服务器所需的环境变量

3. 点击"测试连接"验证配置
4. 点击"保存"创建服务器

### 配置示例

#### Stdio 服务器
```json
{
  "id": "filesystem",
  "type": "stdio",
  "command": "npx",
  "args": ["-y", "@modelcontextprotocol/server-filesystem", "/path/to/directory"],
  "env": {}
}
```

#### SSE 服务器
```json
{
  "id": "remote-api",
  "type": "sse",
  "url": "https://api.example.com/mcp",
  "headers": {
    "Authorization": "Bearer your-token"
  }
}
```

### 编辑服务器

1. 在服务器列表中点击"编辑"按钮
2. 修改配置
3. 点击"测试连接"验证更改
4. 点击"保存"应用更改

⚠️ **注意**: 编辑服务器配置会断开现有连接并重新连接。

### 连接控制

- **连接**: 点击"连接"按钮启动服务器连接
- **断开**: 点击"断开"按钮关闭服务器连接
- **重连**: 断开后再次连接以重新加载服务器

### 删除服务器

1. 点击服务器的"删除"按钮
2. 确认删除操作
3. 服务器配置将被永久删除

⚠️ **警告**: 删除服务器会影响使用该服务器的所有组。

## 工具管理

浏览、搜索和测试 MCP 工具。

### 工具列表

工具列表显示所有可用的工具：

| 列名 | 说明 |
|------|------|
| 工具名称 | 工具的唯一标识符 |
| 描述 | 工具功能说明 |
| 服务器 | 提供该工具的服务器 |
| 状态 | 可用/不可用 |
| 操作 | 查看详情/测试 |

### 搜索和过滤

使用搜索和过滤功能快速找到工具：

- **搜索框**: 按工具名称或描述搜索
- **服务器过滤**: 只显示特定服务器的工具
- **组过滤**: 只显示特定组允许的工具
- **状态过滤**: 只显示可用或不可用的工具

### 查看工具详情

点击工具名称查看详细信息：

- **基本信息**: 名称、描述、服务器
- **输入模式**: 工具接受的参数及其类型
- **使用示例**: 如何调用该工具
- **执行历史**: 最近的执行记录

### 测试工具

1. 点击工具的"测试"按钮
2. 在参数表单中输入参数值
3. 点击"执行"按钮
4. 查看执行结果：
   - **成功**: 显示工具返回的内容
   - **失败**: 显示错误信息和诊断建议

### 执行历史

查看工具的执行历史：

- **时间戳**: 执行时间
- **参数**: 使用的参数
- **结果**: 执行结果摘要
- **执行时间**: 耗时（毫秒）
- **状态**: 成功/失败

点击历史记录可以查看完整的请求和响应详情。

## 组管理

组用于将多个服务器组织在一起，并控制工具访问。

### 组列表

显示所有已配置的组：

| 列名 | 说明 |
|------|------|
| 组 ID | 组的唯一标识符 |
| 名称 | 组的显示名称 |
| 服务器数 | 组中的服务器数量 |
| 工具数 | 组中可用的工具数量 |
| 状态 | 启用/禁用 |
| 操作 | 编辑/删除 |

### 创建新组

1. 点击"创建组"按钮
2. 填写组配置：

   **基本信息**:
   - **组 ID**: 唯一标识符（如 `development`）
   - **名称**: 显示名称（如 "开发工具组"）
   - **描述**: 组用途说明

   **成员服务器**:
   - 从可用服务器列表中选择要包含的服务器
   - 可以选择多个服务器

   **工具过滤**:
   - **允许所有工具**: 允许访问所有服务器的工具
   - **自定义工具列表**: 只允许特定的工具
   - 从工具列表中选择允许的工具

   **验证设置**:
   - **需要验证**: 是否需要验证密钥
   - **验证密钥**: 设置访问该组所需的密钥

3. 点击"保存"创建组

### 编辑组

1. 点击组的"编辑"按钮
2. 修改组配置
3. 点击"保存"应用更改

### 组端点

每个组都有专用的 MCP 端点：

```
http://localhost:3000/:groupId/mcp
```

例如，`development` 组的端点：
```
http://localhost:3000/development/mcp
```

### 验证密钥

如果组设置了验证密钥，访问时需要提供：

```bash
curl -X POST http://localhost:3000/development/mcp/call_tool \
  -H "X-Validation-Key: your-validation-key" \
  -H "Content-Type: application/json" \
  -d '{"name": "read_file", "arguments": {"path": "/file.txt"}}'
```

## API 到 MCP 集成

将现有的 REST API 转换为 MCP 工具。

### API 配置列表

显示所有已配置的 API 到 MCP 服务：

| 列名 | 说明 |
|------|------|
| 配置名称 | API 配置的名称 |
| API URL | API 端点地址 |
| 方法 | HTTP 方法 |
| 生成的工具 | 生成的 MCP 工具数量 |
| 状态 | 活动/非活动/错误 |
| 操作 | 测试/编辑/删除 |

### 添加 API 配置

1. 点击"添加 API 配置"按钮
2. 填写 API 配置表单：

   **基本信息**:
   - **配置名称**: 配置的唯一标识符
   - **描述**: API 用途说明
   - **工具名称**: 生成的 MCP 工具名称

   **API 设置**:
   - **URL**: API 端点地址
   - **方法**: GET / POST / PUT / DELETE
   - **请求头**: 自定义 HTTP 请求头
   - **认证**: API 认证配置（Bearer Token / API Key / Basic Auth）

   **参数映射**:
   - 定义 MCP 工具参数到 API 参数的映射
   - 支持路径参数、查询参数、请求体参数
   - 可以设置默认值和参数转换

   **响应处理**:
   - **响应路径**: 从响应中提取数据的 JSON 路径
   - **错误处理**: 如何处理 API 错误
   - **结果格式**: 返回给 MCP 客户端的格式

3. 点击"测试 API"验证配置
4. 点击"保存"创建配置

### 参数映射编辑器

可视化的参数映射编辑器：

1. **左侧**: MCP 工具参数定义
   - 参数名称
   - 参数类型
   - 是否必需
   - 描述

2. **中间**: 映射关系
   - 拖拽连线建立映射
   - 设置参数转换规则
   - 配置默认值

3. **右侧**: API 参数位置
   - 路径参数 (Path)
   - 查询参数 (Query)
   - 请求体 (Body)
   - 请求头 (Header)

### 测试 API 配置

1. 点击配置的"测试"按钮
2. 输入测试参数
3. 点击"执行测试"
4. 查看测试结果：
   - API 请求详情
   - API 响应内容
   - 转换后的 MCP 响应
   - 执行时间和状态

### 导入/导出配置

**导出配置**:
1. 选择要导出的配置
2. 点击"导出"按钮
3. 下载 JSON 配置文件

**导入配置**:
1. 点击"导入"按钮
2. 选择 JSON 配置文件
3. 确认导入

### 配置示例

```json
{
  "name": "weather-api",
  "description": "获取天气信息",
  "toolName": "get_weather",
  "api": {
    "url": "https://api.weather.com/v1/current",
    "method": "GET",
    "headers": {
      "X-API-Key": "${API_KEY}"
    }
  },
  "parameters": {
    "city": {
      "type": "string",
      "required": true,
      "description": "城市名称",
      "mapping": {
        "target": "query",
        "name": "q"
      }
    }
  },
  "response": {
    "path": "data.current",
    "format": "text"
  }
}
```

## 调试工具

强大的调试和诊断工具。

### MCP 协议监控

实时监控 MCP 协议消息：

1. **消息列表**: 显示所有 MCP 协议消息
   - 时间戳
   - 服务器
   - 消息类型（请求/响应/通知）
   - 方法名称

2. **消息详情**: 点击消息查看完整内容
   - 原始 JSON 格式
   - 格式化显示
   - 语法高亮

3. **过滤选项**:
   - 按服务器过滤
   - 按消息类型过滤
   - 按方法名称搜索
   - 时间范围过滤

### 工具调试器

交互式工具调试：

1. **选择工具**: 从下拉列表选择要调试的工具
2. **输入参数**: 在表单中输入测试参数
3. **执行调试**: 点击"执行"按钮
4. **查看结果**:
   - 执行日志
   - 请求/响应详情
   - 执行时间分析
   - 错误堆栈（如果有）

### 性能分析器

分析工具性能：

1. **性能统计**:
   - 总请求数
   - 平均响应时间
   - P50 / P95 / P99 响应时间
   - 错误率

2. **工具排行**:
   - 最常用的工具
   - 最慢的工具
   - 错误最多的工具

3. **性能图表**:
   - 响应时间趋势
   - 请求量趋势
   - 错误率趋势

### 错误分析

智能错误诊断：

1. **错误列表**: 显示最近的错误
   - 错误时间
   - 错误类型
   - 错误消息
   - 影响的工具/服务器

2. **错误详情**: 点击错误查看详细信息
   - 完整错误堆栈
   - 请求上下文
   - 系统状态

3. **修复建议**: 系统提供的修复建议
   - 可能的原因
   - 解决步骤
   - 相关文档链接

## 配置管理

管理系统配置。

### 配置编辑器

可视化配置编辑：

1. **配置分类**:
   - 系统配置
   - 服务器配置
   - 组配置
   - 认证配置

2. **编辑配置**:
   - 使用表单编辑配置项
   - 实时验证
   - 错误提示

3. **保存配置**:
   - 点击"保存"应用更改
   - 系统会验证配置有效性
   - 无效配置会显示错误信息

### 配置验证

在保存前验证配置：

1. 点击"验证配置"按钮
2. 系统检查配置有效性
3. 显示验证结果：
   - ✅ 配置有效
   - ❌ 配置错误（显示错误详情）
   - ⚠️ 配置警告（显示警告信息）

### 配置备份

创建配置备份：

1. 点击"创建备份"按钮
2. 输入备份描述
3. 点击"确认"创建备份
4. 备份将保存在 `backend/config/.backups/` 目录

### 配置恢复

从备份恢复配置：

1. 点击"配置历史"按钮
2. 选择要恢复的备份
3. 预览备份内容
4. 点击"恢复"应用备份
5. 确认恢复操作

⚠️ **警告**: 恢复配置会覆盖当前配置。

### 配置历史

查看配置变更历史：

- **时间戳**: 变更时间
- **用户**: 执行变更的用户
- **变更类型**: 创建/更新/删除
- **变更内容**: 具体的变更详情

点击历史记录可以查看完整的变更对比。

## 常见问题

### 登录问题

**Q: 忘记密码怎么办？**

A: 需要直接编辑配置文件重置密码：
1. 编辑 `backend/config/system.json`
2. 使用 bcrypt 生成新密码哈希
3. 更新配置文件
4. 重启后端服务

**Q: 为什么一直提示"令牌已过期"？**

A: 检查系统时间是否正确，JWT 令牌依赖于准确的系统时间。

### 服务器连接问题

**Q: 服务器显示"连接失败"？**

A: 检查以下几点：
1. 服务器命令和参数是否正确
2. 所需的环境变量是否已设置
3. 服务器进程是否有权限执行
4. 查看后端日志获取详细错误信息

**Q: 服务器连接后立即断开？**

A: 可能的原因：
1. 服务器进程崩溃
2. MCP 协议握手失败
3. 权限问题
4. 查看调试工具中的 MCP 消息获取详情

### 工具执行问题

**Q: 工具执行失败，显示"工具未找到"？**

A: 检查：
1. 服务器是否已连接
2. 工具名称是否正确
3. 如果在组中执行，检查工具是否在允许列表中

**Q: 工具执行超时？**

A: 可能的原因：
1. 工具执行时间过长
2. 服务器响应慢
3. 网络问题
4. 可以在配置中增加超时时间

### 性能问题

**Q: 界面响应慢？**

A: 优化建议：
1. 减少实时监控的更新频率
2. 限制日志和历史记录的数量
3. 关闭不需要的服务器
4. 清理旧的执行历史

**Q: 内存使用过高？**

A: 检查：
1. 连接的服务器数量
2. 缓存的消息和日志数量
3. 考虑重启服务释放内存

### 配置问题

**Q: 配置保存后不生效？**

A: 某些配置需要重启服务：
1. 认证配置
2. 服务器端口
3. JWT 密钥
4. 重启后端服务使配置生效

**Q: 如何备份所有配置？**

A: 备份以下目录：
```bash
backend/config/
```

包含所有配置文件和备份。

### API 到 MCP 问题

**Q: API 配置测试失败？**

A: 检查：
1. API URL 是否可访问
2. 认证信息是否正确
3. 参数映射是否正确
4. 查看测试结果中的详细错误信息

**Q: 生成的工具无法使用？**

A: 验证：
1. API 配置是否已保存
2. 工具是否已生成
3. 在工具列表中查找生成的工具
4. 测试工具执行

## 获取帮助

如果遇到问题：

1. **查看日志**: 后端日志包含详细的错误信息
2. **使用调试工具**: MCP 协议监控和错误分析
3. **查看文档**: 
   - [API 参考](API_REFERENCE.md)
   - [故障排除](TROUBLESHOOTING.md)
4. **提交问题**: 在 GitHub 上提交 Issue

## 相关文档

- [API 参考文档](API_REFERENCE.md)
- [部署指南](DEPLOYMENT.md)
- [故障排除指南](TROUBLESHOOTING.md)
- [开发指南](../README.md)
